<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard â€“ CapTcha Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar { @apply fixed inset-y-0 left-0 w-64 bg-gray-900 border-r border-gray-800 z-40; }
    .sidebar.collapsed { @apply w-20; }
    .nav-item { @apply flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:bg-gray-800 transition; }
    .nav-item.active { @apply bg-indigo-600/20 text-indigo-300; }
    .card { @apply bg-gray-800 p-6 rounded-lg border border-gray-700; }
  </style>
</head>
<body class="bg-gray-900 text-gray-100" x-data="dashboard()" x-init="feather.replace(); loadData()">

<!-- Top Navbar -->
<header class="fixed top-0 left-0 right-0 z-50 bg-gray-900 border-b border-gray-800 flex items-center justify-between px-6 py-3">
  <div class="flex items-center space-x-3">
    <span class="text-xl font-bold">CapTcha Dashboard</span>
  </div>
  <div class="flex items-center space-x-3">
    <button @click="logout()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Logout</button>
  </div>
</header>

<!-- Sidebar -->
<aside class="sidebar" :class="{ 'collapsed': collapsed }">
  <nav class="p-5 space-y-2">
    <a href="#" @click="loadData()" class="nav-item active">
      <i data-feather="airplay" class="w-5 h-5"></i>
      <span x-show="!collapsed">Dashboard</span>
    </a>
  </nav>
</aside>

<!-- Main Content -->
<main class="lg:ml-64 pt-16 px-6">
  <div class="max-w-7xl mx-auto">

    <!-- User Info -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold mb-2">Welcome, <span x-text="user.username || 'User'"></span></h1>
      <p class="text-gray-400">Email: <span x-text="user.email"></span></p>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="card">
        <h3 class="text-lg font-semibold mb-2">Your Injections</h3>
        <p class="text-3xl font-bold" x-text="stats.total_injections"></p>
        <p class="text-sm text-gray-400" x-text="stats.success_rate + '% success rate'"></p>
      </div>
      <div class="card">
        <h3 class="text-lg font-semibold mb-2">Active Keys</h3>
        <p class="text-3xl font-bold" x-text="keys.filter(k => k.status === 'active').length"></p>
        <p class="text-sm text-gray-400">Total Keys: <span x-text="keys.length"></span></p>
      </div>
    </div>

    <!-- Keys Table -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-4">Your Keys</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-700">
              <th class="pb-3 text-left">Key Code</th>
              <th class="pb-3 text-left">Plan</th>
              <th class="pb-3 text-left">Expires</th>
              <th class="pb-3 text-left">Status</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="key in keys" :key="key.id">
              <tr class="border-b border-gray-800">
                <td class="py-3 font-mono" x-text="key.key_code"></td>
                <td class="py-3" x-text="key.plan"></td>
                <td class="py-3" x-text="new Date(key.expires).toLocaleDateString()"></td>
                <td class="py-3">
                  <span :class="key.status === 'active' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'"
                        class="px-2 py-1 rounded-full text-xs">
                    <span x-text="key.status"></span>
                  </span>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</main>

<script>
const API_BASE = 'https://your-api.com/api';

function dashboard() {
  return {
    collapsed: false,
    user: null,
    keys: [],
    stats: { total_injections: 0, success_rate: 0 },
    
    async loadData() {
      try {
        // Get user data and keys
        const response = await fetch(`${API_BASE}/auth`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            discord_id: 'USER_DISCORD_ID', // Get from your auth system
            username: 'Username',
            email: 'user@example.com'
          })
        });
        
        const data = await response.json();
        this.user = data.user;
        this.keys = data.keys;
        
        // Get stats
        const statsResponse = await fetch(`${API_BASE}/stats`);
        this.stats = await statsResponse.json();
      } catch (error) {
        console.error('Failed to load data:', error);
      }
    },

    async logout() {
      await fetch(`${API_BASE}/logout`);
      window.location.href = 'index.html';
    }
  };
}
</script>
</body>
</html>
