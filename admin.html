<script>
// === NO SECRETS HERE ===
const PROXY_URL = 'https://backedddd-1sw.onrender.com';  // ← YOUR VERCEL URL

function admin() {
  return {
    // ... same UI ...

    async exchangeCode(code) {
      const res = await fetch(`${PROXY_URL}/auth/discord?code=${code}`);
      const data = await res.json();
      if (data.error) throw new Error(data.error);

      localStorage.setItem('discord_user', JSON.stringify(data.user));
      this.user = data.user;
      this.isAdmin = ['1393017932610666577', '805954114231205978'].includes(data.user.id);
      if (this.isAdmin) await this.loadData();
    },

    async loadData() {
      this.loading = true;
      try {
        const res = await fetch(`${PROXY_URL}/keys`);
        const { content } = await res.json();
        const lines = content.trim().split('\n').filter(l => l);
        this.keys = lines.map(line => {
          const [code, plan, expires, claimedBy = '—'] = line.split('|');
          const isExpired = new Date(expires) < new Date();
          return { code, plan, expires, status: isExpired ? 'expired' : 'active', claimedBy };
        });
      } catch (err) {
        alert('Failed to load keys: ' + err.message);
      } finally {
        this.loading = false;
      }
    },

    loginWithDiscord() {
      window.location = `https://discord.com/oauth2/authorize?client_id=963238863256567848&redirect_uri=${encodeURIComponent('https://capovh.github.io/CapTcha/admin.html')}&response_type=code&scope=identify`;
    }
  };
}
</script>
